<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>å·éº»è®¡åˆ†å™¨</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            height: 100vh;
            overflow: hidden;
            padding: 0;
            padding-top: max(env(safe-area-inset-top, 0px), 0px);
            padding-bottom: max(env(safe-area-inset-bottom, 0px), 0px);
            color: #333;
            display: flex;
            flex-direction: column;
        }

        .container {
            max-width: 600px;
            width: 100%;
            margin: 0 auto;
            padding: 0 10px 38px 10px;
            padding-top: 75px;
            flex: 1;
            overflow-y: auto;
            display: flex;
            flex-direction: column;
            gap: 8px;
            -webkit-overflow-scrolling: touch;
        }

        .display-box {
            background: white;
            border-radius: 8px;
            padding: 8px 10px;
            min-height: 50px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        .display-title {
            font-size: 11px;
            color: #666;
            margin-bottom: 5px;
            display: flex;
            align-items: center;
            gap: 6px;
            flex-wrap: wrap;
        }

        .display-settings {
            font-size: 9px;
            color: #999;
        }

        .selected-items {
            display: flex;
            flex-wrap: wrap;
            gap: 5px;
            min-height: 28px;
        }

        .selected-tag {
            display: inline-flex;
            align-items: center;
            justify-content: center;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            animation: popIn 0.3s ease;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            line-height: 1.2;
            box-shadow: 0 1px 4px rgba(102, 126, 234, 0.3);
        }

        .selected-tag:hover {
            background: linear-gradient(135deg, #f5576c 0%, #f093fb 100%);
            transform: scale(1.05);
            box-shadow: 0 2px 6px rgba(245, 87, 108, 0.4);
        }

        .selected-tag:active {
            transform: scale(0.95);
        }

        @keyframes popIn {
            0% {
                transform: scale(0);
                opacity: 0;
            }
            50% {
                transform: scale(1.1);
            }
            100% {
                transform: scale(1);
                opacity: 1;
            }
        }

        .section {
            background: white;
            border-radius: 8px;
            padding: 8px 10px;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        .section-title {
            font-size: 12px;
            font-weight: bold;
            color: #764ba2;
            margin-bottom: 6px;
            padding-left: 4px;
            border-left: 3px solid #764ba2;
        }

        .button-group {
            display: flex;
            flex-wrap: wrap;
            gap: 6px;
        }

        .bubble-btn {
            flex: 0 0 calc(25% - 5px);
            min-width: 60px;
            padding: 7px 4px;
            border: 1.5px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            outline: none;
        }

        .bubble-btn:active {
            transform: scale(0.95);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 0 15px rgba(102, 126, 234, 0.5);
        }

        .bubble-btn:hover {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            box-shadow: 0 4px 15px rgba(102, 126, 234, 0.3);
        }

        .bubble-btn.base-score {
            flex: 0 0 calc(25% - 8px);
        }

        .bubble-btn.gang {
            flex: 0 0 calc(25% - 8px);
        }

        .bubble-btn.type {
            flex: 0 0 calc(50% - 3px);
        }

        .bubble-btn.fan-limit {
            flex: 0 0 calc(33.333% - 4px);
        }

        .bubble-btn.hu-method {
            flex: 0 0 calc(50% - 3px);
        }

        .clear-btn {
            position: fixed;
            bottom: calc(38px + env(safe-area-inset-bottom, 0px));
            right: 10px;
            width: 45px;
            height: 45px;
            padding: 0;
            border: none;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            border-radius: 50%;
            font-size: 11px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 3px 12px rgba(245, 87, 108, 0.4);
            transition: all 0.2s ease;
            outline: none;
            z-index: 101;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .clear-btn:active {
            transform: scale(0.9);
        }

        .rules-btn {
            position: fixed;
            bottom: calc(38px + env(safe-area-inset-bottom, 0px));
            right: 60px;
            width: 45px;
            height: 45px;
            padding: 0;
            border: none;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 50%;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 3px 12px rgba(102, 126, 234, 0.4);
            transition: all 0.2s ease;
            outline: none;
            z-index: 101;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .rules-btn:active {
            transform: scale(0.9);
        }

        .multiplier-btn {
            position: fixed;
            bottom: calc(38px + env(safe-area-inset-bottom, 0px));
            right: 110px;
            width: 45px;
            height: 45px;
            padding: 0;
            border: none;
            background: linear-gradient(135deg, #ffa751 0%, #ffe259 100%);
            color: white;
            border-radius: 50%;
            font-size: 18px;
            font-weight: bold;
            cursor: pointer;
            box-shadow: 0 3px 12px rgba(255, 167, 81, 0.4);
            transition: all 0.2s ease;
            outline: none;
            z-index: 101;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .multiplier-btn:active {
            transform: scale(0.9);
        }

        .modal-overlay {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.6);
            z-index: 200;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal-overlay.show {
            display: flex;
        }

        .modal-content {
            background: white;
            border-radius: 15px;
            max-width: 500px;
            width: 100%;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.3);
            animation: modalIn 0.3s ease;
        }

        @keyframes modalIn {
            from {
                transform: scale(0.8);
                opacity: 0;
            }
            to {
                transform: scale(1);
                opacity: 1;
            }
        }

        .modal-header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 20px;
            border-radius: 15px 15px 0 0;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .modal-title {
            font-size: 18px;
            font-weight: bold;
        }

        .modal-close {
            background: none;
            border: none;
            color: white;
            font-size: 28px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0.8;
            transition: opacity 0.2s;
        }

        .modal-close:hover {
            opacity: 1;
        }

        .modal-body {
            padding: 20px;
        }

        .rules-section {
            margin-bottom: 20px;
        }

        .rules-section-title {
            font-size: 15px;
            font-weight: bold;
            color: #764ba2;
            margin-bottom: 10px;
            padding-bottom: 8px;
            border-bottom: 2px solid #f0f0f0;
        }

        .rules-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 8px 0;
            font-size: 14px;
            color: #666;
        }

        .rules-item-name {
            flex: 1;
        }

        .rules-item-value {
            font-weight: bold;
            color: #667eea;
        }

        .settings-toggle {
            background: white;
            border-radius: 8px;
            padding: 6px 10px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.08);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .settings-toggle-text {
            font-size: 11px;
            font-weight: 500;
            color: #764ba2;
        }

        .settings-toggle-icon {
            font-size: 10px;
            color: #764ba2;
            transition: transform 0.3s ease;
        }

        .settings-toggle-icon.open {
            transform: rotate(180deg);
        }

        .settings-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease;
        }

        .settings-content.open {
            max-height: 500px;
        }

        .settings-section {
            background: white;
            border-radius: 8px;
            padding: 8px;
            margin-top: 6px;
            box-shadow: 0 1px 4px rgba(0,0,0,0.06);
        }

        .settings-section-title {
            font-size: 11px;
            font-weight: 600;
            color: #764ba2;
            margin-bottom: 6px;
        }

        .settings-button-group {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .settings-btn {
            flex: 0 0 calc(25% - 5px);
            padding: 6px 3px;
            border: 1.5px solid #667eea;
            background: white;
            color: #667eea;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s ease;
            text-align: center;
            outline: none;
        }

        .settings-btn:active {
            transform: scale(0.95);
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }

        .multiplier-input {
            width: 50px;
            padding: 5px 8px;
            border: 1px solid #667eea;
            border-radius: 8px;
            text-align: center;
            font-size: 13px;
            color: #667eea;
            font-weight: 600;
            outline: none;
        }

        .multiplier-input:focus {
            border-color: #764ba2;
            box-shadow: 0 0 0 2px rgba(118, 75, 162, 0.1);
        }

        .multiplier-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #f0f0f0;
        }

        .multiplier-item:last-child {
            border-bottom: none;
        }

        .multiplier-name {
            font-size: 14px;
            color: #666;
            flex: 1;
        }

        .multiplier-controls {
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .reset-btn {
            background: linear-gradient(135deg, #ffa751 0%, #ffe259 100%);
            color: white;
            border: none;
            padding: 8px 16px;
            border-radius: 15px;
            font-size: 12px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
            margin-top: 10px;
            width: 100%;
        }

        .reset-btn:active {
            transform: scale(0.95);
        }

        .watermark {
            position: fixed;
            bottom: 0;
            left: 0;
            right: 0;
            background: rgba(255, 255, 255, 0.97);
            padding: 5px 165px 5px 10px;
            text-align: center;
            font-size: 8px;
            color: #999;
            border-top: 1px solid #f0f0f0;
            z-index: 100;
            line-height: 1.4;
            padding-bottom: calc(5px + env(safe-area-inset-bottom, 0px));
        }

        .watermark-author {
            color: #667eea;
            font-weight: 600;
        }

        .watermark-note {
            color: #f5576c;
            font-weight: 600;
            margin-top: 2px;
        }

        .empty-hint {
            color: #999;
            font-size: 10px;
            text-align: center;
            padding: 5px 0;
        }

        .score-box {
            position: fixed;
            top: env(safe-area-inset-top, 0px);
            left: 0;
            right: 0;
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            padding: 8px 10px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.2);
            text-align: center;
            z-index: 100;
        }

        .score-label {
            color: white;
            font-size: 10px;
            opacity: 0.95;
            margin-bottom: 2px;
        }

        .score-value {
            color: white;
            font-size: 28px;
            font-weight: bold;
            text-shadow: 1px 1px 3px rgba(0,0,0,0.2);
            line-height: 1.1;
        }

        .score-detail {
            color: white;
            font-size: 9px;
            margin-top: 4px;
            opacity: 0.9;
            line-height: 1.3;
            overflow: hidden;
            text-overflow: ellipsis;
            white-space: nowrap;
        }
    </style>
</head>
<body>
    <!-- åˆ†æ•°æ˜¾ç¤º (å›ºå®šé¡¶éƒ¨) -->
    <div class="score-box" id="scoreBox">
        <div class="score-label">æœ€ç»ˆåˆ†æ•°</div>
        <div class="score-value" id="scoreValue">0</div>
        <div class="score-detail" id="scoreDetail">å½“å‰è®¾ç½®ï¼š1åˆ†åº•åˆ†ï¼Œ32åˆ†å°é¡¶</div>
    </div>

    <div class="container">
        <!-- æ˜¾ç¤ºåŒºåŸŸ -->
        <div class="display-box">
            <div class="display-title">
                <span>å·²é€‰æ‹©ï¼š</span>
                <span class="display-settings" id="displaySettings">åº•åˆ†ï¼š1åˆ†ã€€ä¸Šé™ï¼š32åˆ†</span>
            </div>
            <div class="selected-items" id="selectedItems">
                <div class="empty-hint">è¯·ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®é€‰æ‹©...</div>
            </div>
        </div>

        <!-- è®¾ç½®åŒºåŸŸ -->
        <div class="settings-toggle" onclick="toggleSettings()">
            <span class="settings-toggle-text">âš™ï¸ åº•åˆ†ä¸å°é¡¶è®¾ç½®</span>
            <span class="settings-toggle-icon" id="settingsIcon">â–¼</span>
        </div>
        <div class="settings-content" id="settingsContent">
            <div class="settings-section">
                <div class="settings-section-title">åº•åˆ†</div>
                <div class="settings-button-group">
                    <button class="settings-btn" onclick="addItem('1åˆ†')">1åˆ†</button>
                    <button class="settings-btn" onclick="addItem('2åˆ†')">2åˆ†</button>
                    <button class="settings-btn" onclick="addItem('5åˆ†')">5åˆ†</button>
                    <button class="settings-btn" onclick="addItem('10åˆ†')">10åˆ†</button>
                </div>
            </div>
            <div class="settings-section">
                <div class="settings-section-title">æ»¡åˆ†é™åˆ¶</div>
                <div class="settings-button-group">
                    <button class="settings-btn" onclick="addItem('16åˆ†å°é¡¶')">16åˆ†</button>
                    <button class="settings-btn" onclick="addItem('32åˆ†å°é¡¶')">32åˆ†</button>
                    <button class="settings-btn" onclick="addItem('64åˆ†å°é¡¶')">64åˆ†</button>
                </div>
            </div>
        </div>


        <!-- èƒ¡æ³• -->
        <div class="section">
            <div class="section-title">èƒ¡æ³•</div>
            <div class="button-group">
                <button class="bubble-btn hu-method" onclick="addItem('ç‚¹ç‚®')">ç‚¹ç‚®</button>
                <button class="bubble-btn hu-method" onclick="addItem('è‡ªæ‘¸')">è‡ªæ‘¸</button>
                <button class="bubble-btn hu-method" onclick="addItem('æ å¼€')">æ å¼€</button>
                <button class="bubble-btn hu-method" onclick="addItem('æ ç‚¹')">æ ç‚¹</button>
                <button class="bubble-btn hu-method" onclick="addItem('æŠ¢æ èƒ¡')">æŠ¢æ èƒ¡</button>
                <button class="bubble-btn hu-method" onclick="addItem('æµ·åº•æ')">æµ·åº•æ</button>
                <button class="bubble-btn hu-method" onclick="addItem('è‡ªæ‘¸æµ·åº•æ')">è‡ªæ‘¸æµ·åº•æ</button>
            </div>
        </div>

        <!-- æ  -->
        <div class="section">
            <div class="section-title">æ </div>
            <div class="button-group">
                <button class="bubble-btn gang" onclick="addItem('æ ¹')">æ ¹</button>
                <button class="bubble-btn gang" onclick="addItem('è´´æ ')">è´´æ </button>
                <button class="bubble-btn gang" onclick="addItem('ç¢°æ ')">ç¢°æ </button>
                <button class="bubble-btn gang" onclick="addItem('æš—æ ')">æš—æ </button>
            </div>
        </div>

        <!-- ç‰Œå‹ -->
        <div class="section">
            <div class="section-title">ç‰Œå‹</div>
            <div class="button-group">
                <button class="bubble-btn type" onclick="addItem('å±èƒ¡')">å±èƒ¡</button>
                <button class="bubble-btn type" onclick="addItem('å¤§å¯¹')">å¤§å¯¹</button>
                <button class="bubble-btn type" onclick="addItem('ä¸ƒå°å¯¹')">ä¸ƒå°å¯¹</button>
                <button class="bubble-btn type" onclick="addItem('æ¸…ä¸€è‰²')">æ¸…ä¸€è‰²</button>
                <button class="bubble-btn type" onclick="addItem('é‡‘é’©é’“')">é‡‘é’©é’“</button>
            </div>
        </div>

    </div>

    <!-- è‡ªå®šä¹‰å€æ•°æŒ‰é’® -->
    <button class="multiplier-btn" onclick="showMultipliers()">ğŸ²</button>

    <!-- è§„åˆ™è¯´æ˜æŒ‰é’® -->
    <button class="rules-btn" onclick="showRules()">?</button>

    <!-- æ¸…é™¤æŒ‰é’® (å›ºå®šå³ä¸‹è§’) -->
    <button class="clear-btn" onclick="clearAll()">æ¸…é™¤</button>

    <!-- æ°´å° -->
    <div class="watermark">
        <div class="watermark-author">äº§å“&ç¨‹åºè®¾è®¡ï¼šé˜¿æ˜Ÿ ä¸ AIåŒå­¦ Claude 4.5 | QAæµ‹è¯•ï¼šé•¿é£</div>
        <div class="watermark-note">âš ï¸ ä»…ä¾›ä¸ªäººå­¦ä¹ ä½¿ç”¨ Â· ç¦æ­¢å•†ä¸šåŒ–</div>
    </div>

    <!-- è§„åˆ™è¯´æ˜å¼¹çª— -->
    <div class="modal-overlay" id="rulesModal" onclick="closeRulesIfClickOutside(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="modal-title">ğŸ“– è§„åˆ™è¯´æ˜</div>
                <button class="modal-close" onclick="closeRules()">&times;</button>
            </div>
            <div class="modal-body" id="rulesBody">
                <!-- å°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
            </div>
        </div>
    </div>

    <!-- è‡ªå®šä¹‰å€æ•°å¼¹çª— -->
    <div class="modal-overlay" id="multipliersModal" onclick="closeMultipliersIfClickOutside(event)">
        <div class="modal-content" onclick="event.stopPropagation()">
            <div class="modal-header">
                <div class="modal-title">ğŸ² è‡ªå®šä¹‰å€æ•°</div>
                <button class="modal-close" onclick="closeMultipliersModal()">&times;</button>
            </div>
            <div class="modal-body">
                <div class="rules-section">
                    <div class="rules-section-title">èƒ¡æ³•å€æ•°</div>
                    <div id="huMethodMultipliers"></div>
                </div>
                <div class="rules-section">
                    <div class="rules-section-title">æ å€æ•°ä¸åŠ åˆ†</div>
                    <div id="gangMultipliers"></div>
                </div>
                <div class="rules-section">
                    <div class="rules-section-title">ç‰Œå‹å€æ•°</div>
                    <div id="typeMultipliers"></div>
                </div>
                <div class="rules-section">
                    <button class="reset-btn" onclick="resetMultipliers()">ğŸ”„ æ¢å¤é»˜è®¤å€æ•°</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        let selectedItems = [];

        // é»˜è®¤å€æ•°é…ç½®
        const defaultMultipliers = {
            'æ ¹': 2,
            'è´´æ ': 2,
            'ç¢°æ ': 2,
            'æš—æ ': 2,
            'å±èƒ¡': 1,
            'ç‚¹ç‚®': 1,
            'è‡ªæ‘¸': 2,
            'å¤§å¯¹': 2,
            'ä¸ƒå°å¯¹': 4,
            'æ¸…ä¸€è‰²': 4,
            'é‡‘é’©é’“': 4,
            'æ å¼€': 4,
            'æ ç‚¹': 2,
            'æŠ¢æ èƒ¡': 2,
            'æµ·åº•æ': 2,
            'è‡ªæ‘¸æµ·åº•æ': 4
        };

        const defaultGangBonus = {
            'è´´æ ': 1,
            'ç¢°æ ': 2,
            'æš—æ ': 2
        };

        // ä»localStorageåŠ è½½è‡ªå®šä¹‰å€æ•°
        function loadMultipliers() {
            const saved = localStorage.getItem('customMultipliers');
            if (saved) {
                try {
                    return JSON.parse(saved);
                } catch (e) {
                    return { ...defaultMultipliers };
                }
            }
            return { ...defaultMultipliers };
        }

        function loadGangBonus() {
            const saved = localStorage.getItem('customGangBonus');
            if (saved) {
                try {
                    return JSON.parse(saved);
                } catch (e) {
                    return { ...defaultGangBonus };
                }
            }
            return { ...defaultGangBonus };
        }

        // ä¿å­˜å€æ•°åˆ°localStorage
        function saveMultipliers() {
            localStorage.setItem('customMultipliers', JSON.stringify(multipliers));
            localStorage.setItem('customGangBonus', JSON.stringify(gangBonus));
        }

        // å€æ•°é…ç½®ï¼ˆä»localStorageåŠ è½½ï¼‰
        let multipliers = loadMultipliers();
        let gangBonus = loadGangBonus();

        // åˆ‡æ¢è®¾ç½®é¢æ¿
        function toggleSettings() {
            const content = document.getElementById('settingsContent');
            const icon = document.getElementById('settingsIcon');
            content.classList.toggle('open');
            icon.classList.toggle('open');
        }

        // æ˜¾ç¤ºè‡ªå®šä¹‰å€æ•°å¼¹çª—
        function showMultipliers() {
            renderMultiplierInputs();
            const modal = document.getElementById('multipliersModal');
            modal.classList.add('show');
        }

        // å…³é—­è‡ªå®šä¹‰å€æ•°å¼¹çª—
        function closeMultipliersModal() {
            const modal = document.getElementById('multipliersModal');
            modal.classList.remove('show');
        }

        // ç‚¹å‡»å¤–éƒ¨å…³é—­å€æ•°å¼¹çª—
        function closeMultipliersIfClickOutside(event) {
            if (event.target.id === 'multipliersModal') {
                closeMultipliersModal();
            }
        }

        // æ¸²æŸ“å€æ•°ç¼–è¾‘ç•Œé¢
        function renderMultiplierInputs() {
            // èƒ¡æ³•
            const huMethods = ['ç‚¹ç‚®', 'è‡ªæ‘¸', 'æ å¼€', 'æ ç‚¹', 'æŠ¢æ èƒ¡', 'æµ·åº•æ', 'è‡ªæ‘¸æµ·åº•æ'];
            let huHtml = '';
            huMethods.forEach(item => {
                huHtml += `
                    <div class="multiplier-item">
                        <span class="multiplier-name">${item}</span>
                        <div class="multiplier-controls">
                            <span style="font-size:12px;color:#999;">Ã—</span>
                            <input type="number" class="multiplier-input" value="${multipliers[item]}"
                                   onchange="updateMultiplier('${item}', this.value)" min="1" max="100">
                        </div>
                    </div>
                `;
            });
            document.getElementById('huMethodMultipliers').innerHTML = huHtml;

            // æ 
            const gangItems = ['æ ¹', 'è´´æ ', 'ç¢°æ ', 'æš—æ '];
            let gangHtml = '';
            gangItems.forEach(item => {
                const hasBonus = gangBonus[item] !== undefined;
                gangHtml += `
                    <div class="multiplier-item">
                        <span class="multiplier-name">${item}</span>
                        <div class="multiplier-controls">
                            <span style="font-size:12px;color:#999;">Ã—</span>
                            <input type="number" class="multiplier-input" value="${multipliers[item]}"
                                   onchange="updateMultiplier('${item}', this.value)" min="1" max="100">
                            ${hasBonus ? `
                                <span style="font-size:12px;color:#999;">+</span>
                                <input type="number" class="multiplier-input" value="${gangBonus[item]}"
                                       onchange="updateGangBonus('${item}', this.value)" min="0" max="100">
                                <span style="font-size:11px;color:#999;">åˆ†</span>
                            ` : ''}
                        </div>
                    </div>
                `;
            });
            document.getElementById('gangMultipliers').innerHTML = gangHtml;

            // ç‰Œå‹
            const types = ['å±èƒ¡', 'å¤§å¯¹', 'ä¸ƒå°å¯¹', 'æ¸…ä¸€è‰²', 'é‡‘é’©é’“'];
            let typeHtml = '';
            types.forEach(item => {
                typeHtml += `
                    <div class="multiplier-item">
                        <span class="multiplier-name">${item}</span>
                        <div class="multiplier-controls">
                            <span style="font-size:12px;color:#999;">Ã—</span>
                            <input type="number" class="multiplier-input" value="${multipliers[item]}"
                                   onchange="updateMultiplier('${item}', this.value)" min="1" max="100">
                        </div>
                    </div>
                `;
            });
            document.getElementById('typeMultipliers').innerHTML = typeHtml;
        }

        // æ›´æ–°å€æ•°
        function updateMultiplier(item, value) {
            const numValue = parseInt(value);
            if (!isNaN(numValue) && numValue > 0) {
                multipliers[item] = numValue;
                saveMultipliers();
                calculateScore(); // é‡æ–°è®¡ç®—åˆ†æ•°
            }
        }

        // æ›´æ–°æ åŠ åˆ†
        function updateGangBonus(item, value) {
            const numValue = parseInt(value);
            if (!isNaN(numValue) && numValue >= 0) {
                gangBonus[item] = numValue;
                saveMultipliers();
                calculateScore(); // é‡æ–°è®¡ç®—åˆ†æ•°
            }
        }

        // é‡ç½®ä¸ºé»˜è®¤å€æ•°
        function resetMultipliers() {
            if (confirm('ç¡®å®šè¦æ¢å¤é»˜è®¤å€æ•°å—ï¼Ÿ')) {
                multipliers = { ...defaultMultipliers };
                gangBonus = { ...defaultGangBonus };
                saveMultipliers();
                renderMultiplierInputs();
                calculateScore();
            }
        }

        // æ˜¾ç¤ºè§„åˆ™è¯´æ˜
        function showRules() {
            const modal = document.getElementById('rulesModal');
            const rulesBody = document.getElementById('rulesBody');

            // åŠ¨æ€ç”Ÿæˆè§„åˆ™å†…å®¹
            let html = '';

            // èƒ¡æ³•
            html += '<div class="rules-section">';
            html += '<div class="rules-section-title">èƒ¡æ³•ï¼ˆå•é€‰ï¼‰</div>';
            ['ç‚¹ç‚®', 'è‡ªæ‘¸', 'æ å¼€', 'æ ç‚¹', 'æŠ¢æ èƒ¡', 'æµ·åº•æ', 'è‡ªæ‘¸æµ·åº•æ'].forEach(item => {
                html += `<div class="rules-item"><span class="rules-item-name">${item}</span><span class="rules-item-value">Ã—${multipliers[item]}</span></div>`;
            });
            html += '</div>';

            // æ 
            html += '<div class="rules-section">';
            html += '<div class="rules-section-title">æ ï¼ˆå¯å¤šé€‰ï¼‰</div>';
            ['æ ¹', 'è´´æ ', 'ç¢°æ ', 'æš—æ '].forEach(item => {
                const bonus = gangBonus[item] ? ` + ${gangBonus[item]}åˆ†` : '';
                html += `<div class="rules-item"><span class="rules-item-name">${item}</span><span class="rules-item-value">Ã—${multipliers[item]}${bonus}</span></div>`;
            });
            html += '</div>';

            // ç‰Œå‹
            html += '<div class="rules-section">';
            html += '<div class="rules-section-title">ç‰Œå‹ï¼ˆå¯å¤šé€‰ï¼Œå¤§å¯¹ä¸ä¸ƒå°å¯¹äº’æ–¥ï¼‰</div>';
            ['å±èƒ¡', 'å¤§å¯¹', 'ä¸ƒå°å¯¹', 'æ¸…ä¸€è‰²', 'é‡‘é’©é’“'].forEach(item => {
                html += `<div class="rules-item"><span class="rules-item-name">${item}</span><span class="rules-item-value">Ã—${multipliers[item]}</span></div>`;
            });
            html += '</div>';

            // è¯´æ˜
            html += '<div class="rules-section">';
            html += '<div class="rules-section-title">è®¡åˆ†è¯´æ˜</div>';
            html += '<div style="font-size:13px;color:#999;line-height:1.6;">';
            html += '<p style="margin-bottom:8px;">â€¢ åŸºç¡€åˆ†æ•° = åº•åˆ† Ã— æ‰€æœ‰å€æ•°ç›¸ä¹˜</p>';
            html += '<p style="margin-bottom:8px;">â€¢ æ çš„é¢å¤–åŠ åˆ†åœ¨åŸºç¡€åˆ†æ•°ä¸Šç´¯åŠ </p>';
            html += '<p style="margin-bottom:8px;">â€¢ æ»¡åˆ†é™åˆ¶ï¼šåŸºç¡€åˆ†æ•°è¾¾åˆ°ä¸Šé™åï¼Œæ çš„é¢å¤–åŠ åˆ†ä»ç„¶æœ‰æ•ˆ</p>';
            html += '<p>â€¢ ç‚¹å‡»å·²é€‰æ‹©çš„æ ‡ç­¾å¯ä»¥åˆ é™¤</p>';
            html += '</div>';
            html += '</div>';

            // ç‰ˆæƒä¿¡æ¯
            html += '<div class="rules-section" style="border-top:2px solid #f0f0f0;padding-top:15px;">';
            html += '<div style="text-align:center;font-size:13px;color:#667eea;font-weight:600;margin-bottom:5px;">äº§å“&ç¨‹åºè®¾è®¡ï¼šé˜¿æ˜Ÿ ä¸ AIåŒå­¦ Claude 4.5</div>';
            html += '<div style="text-align:center;font-size:12px;color:#999;margin-bottom:8px;">QAæµ‹è¯•ï¼šé•¿é£</div>';
            html += '<div style="text-align:center;font-size:12px;color:#f5576c;font-weight:600;">âš ï¸ ä»…ä¾›ä¸ªäººå­¦ä¹ ä½¿ç”¨ Â· ç¦æ­¢å•†ä¸šåŒ–</div>';
            html += '<div style="text-align:center;font-size:11px;color:#bbb;margin-top:8px;">æœ¬å·¥å…·å®Œå…¨å…è´¹å¼€æºï¼Œè¯·å‹¿ç”¨äºå•†ä¸šç”¨é€”</div>';
            html += '</div>';

            rulesBody.innerHTML = html;
            modal.classList.add('show');
        }

        // å…³é—­è§„åˆ™è¯´æ˜
        function closeRules() {
            const modal = document.getElementById('rulesModal');
            modal.classList.remove('show');
        }

        // ç‚¹å‡»å¤–éƒ¨å…³é—­
        function closeRulesIfClickOutside(event) {
            if (event.target.id === 'rulesModal') {
                closeRules();
            }
        }

        // èƒ¡æ³•é€‰é¡¹ï¼ˆäº’æ–¥ï¼‰
        const huMethods = ['ç‚¹ç‚®', 'è‡ªæ‘¸', 'æ å¼€', 'æ ç‚¹', 'æŠ¢æ èƒ¡', 'æµ·åº•æ', 'è‡ªæ‘¸æµ·åº•æ'];

        // äº’æ–¥çš„ç‰Œå‹
        const exclusiveTypes = {
            'å¤§å¯¹': 'ä¸ƒå°å¯¹',
            'ä¸ƒå°å¯¹': 'å¤§å¯¹'
        };

        function addItem(item, event) {
            // æ£€æŸ¥æ˜¯å¦ä¸ºæ»‘åŠ¨æ“ä½œï¼Œå¦‚æœæ˜¯åˆ™ä¸æ‰§è¡Œ
            if (isTouchMove) {
                return;
            }

            // åº•åˆ†äº’æ–¥é€»è¾‘ï¼ˆå•é€‰ï¼‰
            const baseScoreOptions = ['1åˆ†', '2åˆ†', '5åˆ†', '10åˆ†'];
            if (baseScoreOptions.includes(item)) {
                // åˆ é™¤ä¹‹å‰çš„åº•åˆ†é€‰é¡¹
                selectedItems = selectedItems.filter(i => !baseScoreOptions.includes(i));
            }

            // å°é¡¶äº’æ–¥é€»è¾‘ï¼ˆå•é€‰ï¼‰
            if (item.includes('å°é¡¶')) {
                // åˆ é™¤ä¹‹å‰çš„å°é¡¶é€‰é¡¹
                selectedItems = selectedItems.filter(i => !i.includes('å°é¡¶'));
            }

            // èƒ¡æ³•äº’æ–¥é€»è¾‘
            if (huMethods.includes(item)) {
                // åˆ é™¤ä¹‹å‰çš„èƒ¡æ³•é€‰é¡¹
                selectedItems = selectedItems.filter(i => !huMethods.includes(i));
            }

            // ç‰Œå‹äº’æ–¥é€»è¾‘
            if (exclusiveTypes[item]) {
                const excludeItem = exclusiveTypes[item];
                selectedItems = selectedItems.filter(i => i !== excludeItem);
            }

            selectedItems.push(item);
            updateDisplay();
            calculateScore();
        }

        function updateDisplay() {
            const container = document.getElementById('selectedItems');
            const settingsContainer = document.getElementById('displaySettings');

            // è·å–åº•åˆ†å’Œæ»¡åˆ†é™åˆ¶
            const baseScoreItem = selectedItems.find(item => item.includes('åˆ†') && !item.includes('å°é¡¶'));
            const scoreLimitItem = selectedItems.find(item => item.includes('å°é¡¶'));

            // æ›´æ–°è®¾ç½®æ˜¾ç¤º
            const baseScoreText = baseScoreItem ? baseScoreItem : '1åˆ†';
            const scoreLimitText = scoreLimitItem ? scoreLimitItem.replace('å°é¡¶', '') : '32åˆ†';
            settingsContainer.textContent = `åº•åˆ†ï¼š${baseScoreText}ã€€ä¸Šé™ï¼š${scoreLimitText}`;

            // è¿‡æ»¤æ‰åº•åˆ†å’Œæ»¡åˆ†é™åˆ¶ï¼Œåªæ˜¾ç¤ºå…¶ä»–é€‰é¡¹
            const displayItems = selectedItems.filter(item =>
                !item.includes('åˆ†') || (!['1åˆ†', '2åˆ†', '5åˆ†', '10åˆ†'].includes(item) && !item.includes('å°é¡¶'))
            ).filter(item => !item.includes('å°é¡¶'));

            if (displayItems.length === 0) {
                container.innerHTML = '<div class="empty-hint">è¯·ç‚¹å‡»ä¸‹æ–¹æŒ‰é’®é€‰æ‹©...</div>';
                return;
            }

            container.innerHTML = displayItems.map((item) => {
                // æ‰¾åˆ°åŸå§‹ç´¢å¼•
                const realIndex = selectedItems.indexOf(item);
                return `<span class="selected-tag" onclick="removeItem(${realIndex})">${item}</span>`;
            }).join('');
        }

        function removeItem(index) {
            selectedItems.splice(index, 1);
            updateDisplay();
            calculateScore();
        }

        function calculateScore() {
            // è·å–åº•åˆ†
            const baseScoreItem = selectedItems.find(item => item.includes('åˆ†') && !item.includes('å°é¡¶'));
            const baseScore = baseScoreItem ? parseInt(baseScoreItem) : 1;

            // è·å–æ»¡åˆ†é™åˆ¶
            const scoreLimitItem = selectedItems.find(item => item.includes('å°é¡¶'));
            let scoreLimit = scoreLimitItem ? parseInt(scoreLimitItem) : 32;

            // è®¡ç®—å€æ•°
            let totalMultiplier = 1;
            let details = [];
            let hasMultiplier = false;

            selectedItems.forEach((item) => {
                if (item.includes('åˆ†')) {
                    return; // è·³è¿‡åº•åˆ†å’Œæ»¡åˆ†é™åˆ¶
                }

                const multiplier = multipliers[item];
                if (multiplier) {
                    totalMultiplier *= multiplier;
                    details.push(`${item}: x${multiplier}`);
                    hasMultiplier = true;
                }
            });

            // è®¡ç®—åŸºç¡€åˆ†æ•°
            let baseCalculatedScore = baseScore * totalMultiplier;
            let finalScore = baseCalculatedScore;

            // åº”ç”¨æ»¡åˆ†é™åˆ¶
            let isLimited = false;
            if (scoreLimit && baseCalculatedScore > scoreLimit) {
                finalScore = scoreLimit;
                isLimited = true;
            }

            // è®¡ç®—æ çš„é¢å¤–åŠ åˆ†ï¼ˆæ»¡åˆ†åä»å¯åŠ åˆ†ï¼‰
            let bonusScore = 0;
            selectedItems.forEach(item => {
                if (gangBonus[item]) {
                    bonusScore += gangBonus[item];
                }
            });

            if (bonusScore > 0) {
                finalScore += bonusScore;
            }

            // æ˜¾ç¤ºç»“æœ
            document.getElementById('scoreValue').textContent = finalScore;

            // æ„å»ºè¯¦ç»†è¯´æ˜
            if (!hasMultiplier && bonusScore === 0) {
                document.getElementById('scoreDetail').textContent = 'è¯·é€‰æ‹©èƒ¡æ³•æˆ–ç‰Œå‹';
            } else {
                let detailText = `åº•åˆ†${baseScore}åˆ†`;
                if (details.length > 0) {
                    detailText += ' | ' + details.join(' | ');
                }
                if (isLimited) {
                    detailText += ` | ${baseScore}Ã—${totalMultiplier}=${baseCalculatedScore} â†’ å°é¡¶${scoreLimit}åˆ†`;
                } else if (totalMultiplier > 1) {
                    detailText += ` | ${baseScore}Ã—${totalMultiplier}=${baseCalculatedScore}åˆ†`;
                }
                if (bonusScore > 0) {
                    detailText += ` | æ åŠ åˆ†+${bonusScore}`;
                }
                document.getElementById('scoreDetail').innerHTML = detailText;
            }
        }

        function clearAll() {
            selectedItems = [];
            // é‡æ–°æ·»åŠ é»˜è®¤å€¼
            selectedItems.push('1åˆ†');
            selectedItems.push('32åˆ†å°é¡¶');
            updateDisplay();
            calculateScore();
        }

        // é˜²æ­¢åŒå‡»ç¼©æ”¾å’Œæ»‘åŠ¨è¯¯è§¦
        let lastTouchEnd = 0;
        let touchStartX = 0;
        let touchStartY = 0;
        let isTouchMove = false;

        document.addEventListener('touchstart', function(event) {
            touchStartX = event.touches[0].clientX;
            touchStartY = event.touches[0].clientY;
            isTouchMove = false;
        }, { passive: true });

        document.addEventListener('touchmove', function(event) {
            const touchX = event.touches[0].clientX;
            const touchY = event.touches[0].clientY;
            const deltaX = Math.abs(touchX - touchStartX);
            const deltaY = Math.abs(touchY - touchStartY);

            // å¦‚æœç§»åŠ¨è¶…è¿‡10pxï¼Œæ ‡è®°ä¸ºæ»‘åŠ¨
            if (deltaX > 10 || deltaY > 10) {
                isTouchMove = true;
            }
        }, { passive: true });

        document.addEventListener('touchend', function(event) {
            const now = Date.now();
            if (now - lastTouchEnd <= 300) {
                event.preventDefault();
            }
            lastTouchEnd = now;
        }, false);

        // è·å–æ˜¯å¦ä¸ºæ»‘åŠ¨æ“ä½œ
        function isTouchMoving() {
            return isTouchMove;
        }

        // é¡µé¢åŠ è½½æ—¶åˆå§‹åŒ–é»˜è®¤å€¼
        window.addEventListener('DOMContentLoaded', function() {
            addItem('1åˆ†');
            addItem('32åˆ†å°é¡¶');
        });
    </script>
</body>
</html>

